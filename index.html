<!DOCTYPE html>
<html>
<head>
    <title>FeistyPass - The Feistel Network Password Manager</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">
        table   {margin: auto;}
    </style>
	<link rel="stylesheet" href="styles/jquery.mobile-1.4.2.min.css">
	<script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/jquery.mobile-1.4.2.js"></script>
    <script type="text/javascript" src="scripts/SHA-512.js"></script>
    <script type="text/javascript" src="scripts/feistel.js"></script>
    <script type="text/javascript" src="scripts/structure.js"></script>
    <script type="text/javascript">
// populate the edit entry form with the current entry's data
function getCurrentEntry () {
    document.getElementById("edit-name").value =            structure.current.name;
    document.getElementById("edit-notes").value =           structure.current.notes;
    document.getElementById("edit-encrypt-notes").checked = structure.current.encryptNotes;
    document.getElementById("edit-key").value =             structure.current.key;
    document.getElementById("edit-pass").value =            "";
    document.getElementById("edit-confirm").value =         "";
    document.getElementById("edit-protocal").value =        structure.current.protocal;
}

// save the edit entry form's data to the current entry
// TODO: tell the user that the changes have been saved, or say why they haven't
function editCurrentEntry () {
    var name =          document.getElementById("edit-name").value;
    var notes =         document.getElementById("edit-notes").value;
    var encryptNotes =  document.getElementById("edit-encrypt-notes").checked;
    var key =           document.getElementById("edit-key").value;
    var pass1 =         document.getElementById("edit-pass").value;
    var pass2 =         document.getElementById("edit-confirm").value;
    var protocal =      document.getElementById("edit-protocal").value;

    if (name.length <= 0) {
        return;
    }
    if (pass1 != pass2) {
        return;
    }

    structure.current.name = name;
    structure.current.notes = notes;
    structure.current.encryptNotes = encryptNotes;
    structure.current.key = key;
    if (pass1.length > 0) {
        structure.current.hashedPassword = SHA512(pass1);
    }
    structure.current.protocal = protocal;
    structure.current.display();
}

// resets the new entry form for next use
function resetNew () {
    document.getElementById("new-name").value = "New Entry";
    document.getElementById("new-notes").value = "";
    document.getElementById("new-encrypt-notes").checked = false;
    document.getElementById("new-key").value = "needBetterKeySystem";
    document.getElementById("new-pass").value = "";
    document.getElementById("new-confirm").value = "";
    document.getElementById("new-protocal").value = "default";
}

// creates a new entry as a item of the current entry
// TODO: tell the user that the has been created, or say why it hasn't
function createEntry () {
    var name =          document.getElementById("new-name").value;
    var notes =         document.getElementById("new-notes").value;
    var encryptNotes =  document.getElementById("new-encrypt-notes").checked;
    var key =           document.getElementById("new-key").value;
    var pass1 =         document.getElementById("new-pass").value;
    var pass2 =         document.getElementById("new-confirm").value;
    var protocal =      document.getElementById("new-protocal").value;

    if (name.length <= 0) {
        return;
    }
    if (pass1 != pass2) {
        return;
    }

    structure.current.add(new Entry(name, notes, key, SHA512(pass1), protocal, encryptNotes));
    structure.current.display();
}

// deletes the current entry if the current entry is not master
// after deletion, move user to parent of deleted entry
// TODO: state that it was deleted or say why deletion failed
function deleteCurrentEntry () {
    if (structure.current != structure.master) {
        structure.current["parent"].remove(structure.current.index);
        structure.current["parent"].display();
    }
}

function toParent () {
    if (typeof structure.current["parent"] != "undefined") {
        structure.current["parent"].display();
    }
}
    </script>
</head>
<body onload="structure.master.display()">
    <div data-role="page" id="mainlist">
        <div data-role="header" data-theme="a">
            <h1 id="list-title">Master List</h1>
            <span class="ui-li-count" id="encryption-status"></span>
        </div>
        <ul data-role="listview" data-inset="true" id="list" role="main" class="ui-content">
            <li>
                <p>Page Loading....</p>
                <button data-inline="true" class="ui-li-count"></button>
            </li>
        </ul>

        <!-- Footer Buttons -->
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li>
                        <a href="#new" onclick="resetNew()"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-plus ui-btn-icon-bottom ui-btn-a">New</a>
                    </li>
                    <li>
                        <a href="#edit" onclick="getCurrentEntry()"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-edit ui-btn-icon-bottom ui-btn-a">Edit</a>
                    </li>
                    <li class="hideOnMaster">
                        <a href="#delete"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-delete ui-btn-icon-bottom ui-btn-a">Delete</a>
                    </li>
                </ul>
                <ul>
                    <li class="hideOnMaster">
                        <a href="#list" onclick="toParent()"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-arrow-u ui-btn-icon-bottom ui-btn-a">Parent</a>
                    </li>
                    <li>
                        <a href="#move"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-action ui-btn-icon-bottom ui-btn-a">Move</a>
                    </li>
                    <li>
                        <a href="help.html"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-info ui-btn-icon-bottom ui-btn-a">Help</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Create Entry Dialoge -->
    <div data-role="page" id="new">
        <div data-role="header" data-theme="a">
            <h1>Create New List</h1>
        </div>
        <div role="main" class="ui-content">
            <table><tr>
                <th>Name</th>
                <td><input id="new-name" value="New Entry" /></td>
            </tr><tr>
                <td colspan="2">
                    <textarea  name="new-notes" id="new-notes" placeholder="Notes"></textarea>
                    <label for="new-notes" class="ui-hidden-accessible">Notes</label>
                </td>
            </tr><tr>
                <th colspan="2">
                    <input name="new-encrypt-notes" id="new-encrypt-notes" data-mini="true" type="checkbox">
                    <label for="new-encrypt-notes">Encrypt Notes</label>
                </th>
            </tr><tr>
                <th>Key</th>
                <td><input id="new-key" value="w4f53" /></td>
            </tr><tr>
                <th colspan="2">
                    <input name="new-pass" id="new-pass" type="password" placeholder="Password" value="">
                    <label for="new-pass" class="ui-hidden-accessible">Password</label>
                </th>
            </tr><tr>
                <th colspan="2">
                    <input name="new-confirm" id="new-confirm" type="password" placeholder="Confirm Password" value="">
                    <label for="new-confirm" class="ui-hidden-accessible">Confirm Password</label>
                </th>
            </tr><tr>
                <th>Encryption</th>
                <td>
                    <select id="new-protocal">
                        <option>Default</option>
                        <option>Feistel 10</option>
                    </select>
                </td>
            </tr></table>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li>
                        <a href="#" data-rel="back"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-back ui-btn-icon-bottom ui-btn-a">Cancel</a>
                    </li>
                    <li>
                        <a href="#" data-rel="back" data-transition="flow" onclick="createEntry()"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-plus ui-btn-icon-bottom ui-btn-a">Create</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Edit Entry Dialoge -->
    <div data-role="page" id="edit">
        <div data-role="header" data-theme="a">
            <h1>Edit <span class="menu-title">Master List</span></h1>
        </div>
        <div role="main" class="ui-content">
            <table><tr>
                <th>Name</th>
                <td><input id="edit-name" value="Master List" /></td>
            </tr><tr>
                <td colspan="2">
                    <textarea  name="edit-notes" id="edit-notes" placeholder="Notes"></textarea>
                    <label for="edit-notes" class="ui-hidden-accessible">Notes</label>
                </td>
            </tr><tr>
                <th colspan="2">
                    <input name="edit-encrypt-notes" id="edit-encrypt-notes" data-mini="true" type="checkbox">
                    <label for="edit-encrypt-notes">Encrypt Notes</label>
                </th>
            </tr><tr>
                <th>Key</th>
                <td><input id="edit-key" value="w4f53" /></td>
            </tr><tr>
                <th colspan="2">
                    <input name="edit-pass" id="edit-pass" type="password" placeholder="Password" value="">
                    <label for="edit-pass" class="ui-hidden-accessible">Password</label>
                </th>
            </tr><tr>
                <th colspan="2">
                    <input name="edit-confirm" id="edit-confirm" type="password" placeholder="Confirm Password" value="">
                    <label for="edit-confirm" class="ui-hidden-accessible">Confirm Password</label>
                </th>
            </tr><tr>
                <th>Encryption</th>
                <td>
                    <select id="edit-protocal">
                        <option>Default</option>
                        <option>Feistel 10</option>
                    </select>
                </td>
            </tr></table>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li>
                        <a href="#" data-rel="back"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-back ui-btn-icon-bottom ui-btn-a">Cancel</a>
                    </li>
                    <li>
                        <a href="#" data-rel="back" data-transition="flow" onclick="editCurrentEntry()"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-edit ui-btn-icon-bottom ui-btn-a">Save</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Delete Entry Dialoge -->
    <div data-role="page" id="delete">
        <div data-role="header" data-theme="a">
            <h1>Delete Entry?</h1>
        </div>
        <div role="main" class="ui-content">
            <h3 class="ui-title">Are you sure you want to delete this page?</h3>
            <p>This action cannot be undone.</p>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li>
                        <a href="#" data-rel="back"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-back ui-btn-icon-bottom ui-btn-a">Cancel</a>
                    </li>
                    <li>
                        <a href="#" data-rel="back" data-transition="flow" onclick="deleteCurrentEntry()"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-delete ui-btn-icon-bottom ui-btn-a">Delete</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Move Entry Dialoge -->
    <div data-role="page" id="move">
        <div data-role="header" data-theme="a">
            <h1>Move Entry</h1>
        </div>
        <div role="main" class="ui-content">
            <p>Coming soon.</p>
        </div>
    </div>

</body>
</html>
